spack:
  view: false

  concretizer:
    reuse: false
    unify: when_possible

  packages:
    all:
      require: '%gcc target=x86_64_v3'
      providers:
        blas: [openblas]
        mpi: [mpich]
      variants: +mpi
    binutils:
      variants: +ld +gold +headers +libiberty ~nls
    elfutils:
      variants: ~nls
    gdb:
      version: [14.1]
    hdf5:
      variants: +fortran +hl +shared
    libfabric:
      variants: fabrics=sockets,tcp,udp,rxm
    libunwind:
      variants: +pic +xz
    openblas:
      variants: threads=openmp
    xz:
      variants: +pic
    mesa:
      version: [21.3.8]
    mpi:
      require: mpich
    mpich:
      require: '~wrapperrpath ~hwloc'
    ncurses:
      require: '@6.3 +termlib'
    tbb:
      require: intel-tbb
    boost:
      version: [1.79.0]
      variants: +atomic +chrono +container +date_time +exception +filesystem +graph
        +iostreams +locale +log +math +mpi +multithreaded +program_options +random
        +regex +serialization +shared +signals +stacktrace +system +test +thread +timer
        cxxstd=17 visibility=global
    libffi:
      require: "@3.4.4"
    cuda:
      version: [11.8.0]

    # Mark geant4 data as external to prevent wasting bandwidth on GB-scale files
    geant4-data:
      externals:
        - spec: geant4-data@11.2.0
          prefix: /usr
        - spec: geant4-data@11.1.0
          prefix: /usr
        - spec: geant4-data@11.0.0
          prefix: /usr

  specs:
  # CPU
  - acts +analysis +binaries +dd4hep +edm4hep +examples +fatras +geant4 +hepmc3 +identification +podio +pythia8 +python +tgeo
  - dd4hep +ddalign +ddcad +ddcond +dddetectors +dddigi +ddeve +ddg4 +ddrec +edm4hep +hepmc3 +lcio +utilityapps +xercesc
  - delphes +pythia8
  - edm4hep
  - fastjet
  - fjcontrib
  - gaudi +aida +examples +heppdt +xercesc ^gdb +python
  - geant4 +opengl +qt +threads ~vtk
  - hepmc
  - hepmc3 +interfaces +protobuf +python +rootio
  - herwig3 +njet +vbfnlo
  - lcio -examples ~jar +rootdict  # Note: lcio +examples ^ncurses -termlib, which leads to conflicts
  - lhapdf +python
  - madgraph5amc
  - opendatadetector
  - podio +rntuple +sio
  - py-uproot +lz4 +xrootd +zstd
  - pythia8 +evtgen +fastjet +hdf5 +hepmc +hepmc3 +lhapdf ~madgraph5amc +python +rivet -root # pythia8 and root circularly depend
  - rivet hepmc=3
  - root +davix +dcache +examples +fftw +fits +fortran +gdml +graphviz +gsl +http +math +minuit +mlp +mysql +opengl ~oracle ~postgres +pythia6 +pythia8 +python +r +roofit +root7 ~shadow +spectrum +sqlite +ssl +tbb +threads +tmva +unuran +vc +vdt +veccore +webgui +x +xml +xrootd
  - sherpa +analysis -blackhat +fastjet +gzip +hepmc2 +hepmc3 +hepmc3root +hztool +lhapdf +lhole +openloops +pythia ~python ~recola ~rivet +root +ufo
  - thepeg ~rivet
  - vecgeom +gdml +geant4 +root
  - xrootd +davix +http +krb5 +python +readline +scitokens-cpp

  ci:
    pipeline-gen:
    - build-job:
        image: "ghcr.io/spack/ubuntu20.04-runner-amd64-gcc-11.4:2023.08.01"

  cdash:
    build-group: HEP
